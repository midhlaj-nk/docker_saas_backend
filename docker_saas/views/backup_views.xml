<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- ======================= -->
    <!-- Backup Config Tree -->
    <!-- ======================= -->
    <record id="view_docker_backup_config_tree" model="ir.ui.view">
        <field name="name">docker.backup.config.tree</field>
        <field name="model">docker.backup.config</field>
        <field name="arch" type="xml">
            <tree string="Backup Configurations">
                <field name="name"/>
                <field name="instance_id"/>
                <field name="backup_frequency"/>
                <field name="backup_directory"/>
                <field name="last_execution"/>
                <field name="next_execution"/>
                <field name="last_status" widget="badge" 
                       decoration-success="last_status == 'success'"
                       decoration-danger="last_status == 'failed'"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- ======================= -->
    <!-- Backup Config Form -->
    <!-- ======================= -->
    <record id="view_docker_backup_config_form" model="ir.ui.view">
        <field name="name">docker.backup.config.form</field>
        <field name="model">docker.backup.config</field>
        <field name="arch" type="xml">
            <form string="Backup Configuration">
                <header>
                    <button name="action_execute_backup" 
                            string="Run Backup Now" 
                            type="object" 
                            class="btn-primary"/>
                    <field name="active" widget="boolean_toggle"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="instance_id"/>
                            <field name="backup_frequency"/>
                            <field name="backup_directory"/>
                        </group>
                        <group>
                            <field name="auto_prune"/>
                            <field name="days_to_keep" invisible="auto_prune == False"/>
                        </group>
                    </group>

                    <group>
                        <group string="Last Execution">
                            <field name="last_execution" readonly="1"/>
                            <field name="next_execution" readonly="1"/>
                            <field name="last_status" readonly="1"/>
                            <field name="last_message" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Backups">
                            <field name="backup_record_ids" nolabel="1" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="backup_date"/>
                                    <field name="readable_size"/>
                                    <field name="status" widget="badge"
                                           decoration-success="status == 'success'"
                                           decoration-danger="status == 'failed'"/>
                                    <field name="message"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <!-- Chatter -->
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- ======================= -->
    <!-- Backup Record Tree -->
    <!-- ======================= -->
    <record id="view_docker_backup_tree" model="ir.ui.view">
        <field name="name">docker.backup.tree</field>
        <field name="model">docker.backup</field>
        <field name="arch" type="xml">
            <tree string="Backups">
                <field name="name"/>
                <field name="instance_id"/>
                <field name="backup_date"/>
                <field name="readable_size"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'success'"
                       decoration-danger="status == 'failed'"/>
                <field name="message"/>
            </tree>
        </field>
    </record>

    <!-- ======================= -->
    <!-- Actions (referenced in menu.xml) -->
    <!-- ======================= -->
    <record id="action_docker_backup_config" model="ir.actions.act_window">
        <field name="name">Backup Configurations</field>
        <field name="res_model">docker.backup.config</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_docker_backup" model="ir.actions.act_window">
        <field name="name">Backups</field>
        <field name="res_model">docker.backup</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- ======================= -->
    <!-- Backup Record Form -->
    <!-- ======================= -->
    <record id="view_docker_backup_form" model="ir.ui.view">
        <field name="name">docker.backup.form</field>
        <field name="model">docker.backup</field>
        <field name="arch" type="xml">
            <form string="Backup">
                <header>
                    <button name="action_download" 
                            type="object" 
                            string="Download" 
                            class="btn-success"
                            icon="fa-download"
                            invisible="status == 'failed'"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="instance_id" readonly="1"/>
                            <field name="backup_date" readonly="1"/>
                        </group>
                        <group>
                            <field name="file_path" readonly="1"/>
                            <field name="readable_size" readonly="1"/>
                            <field name="status" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <field name="message" readonly="1" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

</odoo>

